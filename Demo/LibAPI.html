<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BookVerse Multi-Library Matcher</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    #searchBar {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .result {
      background: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 6px;
      display: flex;
      gap: 20px;
    }
    .cover {
      flex-shrink: 0;
    }
    .cover img {
      max-width: 150px;
      border-radius: 4px;
    }
    .info {
      flex-grow: 1;
    }
    .section {
      margin-bottom: 15px;
    }
    .section h3 {
      margin-bottom: 5px;
      font-size: 16px;
      color: #2c3e50;
    }
    .section p {
      margin: 0;
      font-size: 14px;
    }
    .error {
      color: #c0392b;
    }
  </style>
</head>
<body>

  <h1>ðŸ“š BookVerse Multi-Library Matcher</h1>
  <input type="text" id="searchBar" placeholder="Search for a book title...">
  <div id="resultContainer"></div>

  <script>
    const resultContainer = document.getElementById('resultContainer');
    const searchBar = document.getElementById('searchBar');

    searchBar.addEventListener('change', async () => {
      const query = searchBar.value.trim();
      resultContainer.innerHTML = '';

      if (!query) return;

      const resultDiv = document.createElement('div');
      resultDiv.className = 'result';

      const olSearchUrl = `https://openlibrary.org/search.json?title=${encodeURIComponent(query)}&fields=*,availability`;

      try {
        const olRes = await fetch(olSearchUrl).then(res => res.json());
        const olMatch = olRes.docs?.[0];

        if (!olMatch) {
          resultDiv.innerHTML = `<p class="error">No Open Library match found.</p>`;
          resultContainer.appendChild(resultDiv);
          return;
        }

        const isbn = olMatch.isbn?.[0];
        const coverId = olMatch.cover_i;
        const lccn = olMatch.lccn?.[0];
        const iaId = olMatch.ia?.[0];
        const gutenbergId = olMatch.id_gutenberg?.[0];

        const coverUrl = coverId
          ? `https://covers.openlibrary.org/b/id/${coverId}-L.jpg`
          : isbn
            ? `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`
            : null;

        const locLink = isbn
          ? `https://catalog.loc.gov/vwebv/search?searchArg=${isbn}&searchCode=ISBN`
          : lccn
            ? `https://id.loc.gov/resources/bibs/${lccn}`
            : null;

        const infoDiv = document.createElement('div');
        infoDiv.className = 'info';

        infoDiv.innerHTML = `
          <div class="section">
            <h3>ðŸ“˜ Library of Congress</h3>
            ${locLink ? `<p><a href="${locLink}" target="_blank">Search in LoC Catalog</a></p>` : '<p>N/A</p>'}
          </div>
          <div class="section">
            <h3>ðŸ“— Open Library</h3>
            <p><strong>Title:</strong> ${olMatch.title || 'N/A'}</p>
            <p><strong>Author:</strong> ${olMatch.author_name?.[0] || 'N/A'}</p>
            <p><strong>Published:</strong> ${olMatch.first_publish_year || 'N/A'}</p>
            <p><a href="https://openlibrary.org${olMatch.key}" target="_blank">View Open Library Record</a></p>
          </div>
          <div class="section">
            <h3>ðŸ“– Internet Archive</h3>
            ${iaId ? `<p><a href="https://archive.org/details/${iaId}" target="_blank">Read on Internet Archive</a></p>` : '<p>N/A</p>'}
          </div>
          <div class="section">
            <h3>ðŸ“˜ Project Gutenberg</h3>
            ${gutenbergId ? `<p><a href="https://www.gutenberg.org/ebooks/${gutenbergId}" target="_blank">Read on Project Gutenberg</a></p>` : '<p>N/A</p>'}
          </div>
        `;

        const coverDiv = document.createElement('div');
        coverDiv.className = 'cover';
        coverDiv.innerHTML = coverUrl ? `<img src="${coverUrl}" alt="Book cover">` : '';

        resultDiv.appendChild(coverDiv);
        resultDiv.appendChild(infoDiv);
      } catch (err) {
        resultDiv.innerHTML = `<p class="error">Error fetching metadata. Try again later.</p>`;
      }

      resultContainer.appendChild(resultDiv);
    });
  </script>

</body>
</html>
